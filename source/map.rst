.. sectionauthor:: Дмитрий Барышников <dmitry.baryshnikov@nextgis.ru>

.. _ngqgis_map:

********************************
Создание карты
********************************

Проекции
====================

В кугисе есть возможность работы с проекциями. У каждого слоя данных есть своя система координат (в которой храняться данные), как правило она записана в самом файле. Почти всегда в кугисе используется функция "преобразования координат на лету": слои хранятся в разных системах координат, а на экран они выводятся в одной. 

Систем координат очень много, однако для работы одновременно используется всего 2-4 штуки, их можно запомнить. 

* WGS 84 (EPSG:4326) - в ней обычно хранятся векторные данные. Единица измерения - градусы. Новые векторные файлы сохраняйте в ней. Если вывести данные из неё без перепроецирования, то картинка будет сплющенной.
* Pseudo Mercator (EPSG:3857) - используется для отображения. Включайте "перепроецирование на лету" в 3857, и карта будет отображаться более правильно.
* WGS 84 / UTM Zone ... (EPSG:12345.. и соседние) - используется для измерения расстояний. Данные хранятся в метрах. Некоторые инструменты требуют её для корректной работы. Так же в ней могут храниться космоснимки. Земной шар разделён на 30 зон, для каждой определена своя проекция - свой код EPSG. Определите зону в которой вы работаете по разграфкам на гис-лабе.
* Pulkovo 1942 / Gauss-Kruger zone ... (EPSG:12345.. и соседние) - устроена так же как UTM, в ней хранятся привязанные листы советских топокарт (изданных в последние годы). Так же разделена на зоны, но с другими номерами. 

.. fixme:
   дописать коды EPSG, возможно сверстать в таблицу

Интерфейс окна выбора системы координат
---------------------------------------------------------------------

QGIS поддерживает перепроецирование растровых и векторных слоёв "на лету", но по умолчанию
эта возможность отключена. Для её активации необходимо установить флажок "Включить 
преобразование координат "на лету" на вкладке "Система координат" диалогового окна 
"Свойства проекта". 
Существует три способа доступа к указанной вкладке:

1. Выберите пункт "Свойства проекта" в меню Редактирование (Gnome, OS X) или Установки
(KDE, Windows).

2. Нажмите кнопку "Преобразование координат", расположенную в правом нижнем углу строки
состояния.

.. figure:: /_static/MapOTF.png
   :align: center
   :width: 35em



.. tip::
   Так же можно его включить по умолчанию: :menuselection:`Параметры --> Система координат --> Система координат для новых проектов` 

.. fixme::
   Переформулировать, очень длинные названия, не понимаю.

.. figure:: /_static/MapProjections.png
   :align: center
   :width: 35em

    Диалог выбора системы координат.

    В этом диалоге имеется 2 списка: сверху - последние выбранные записи, снизу - полный список записей. В строке поиска вы можете вводить нормер EPSG или часть названия. Выбирать систему координат можно из любого списка. 


Основные операции с проекциями, которые нужно знать для работы:
---------------------------------------------------------------------


Как узнать систему координат слоя
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

:menuselection:`Слой --> Свойства --> Вкладка :guilabel:`Общие` --> Система координат`. Это значение можно менять. Систему координат сохранёную в слое можно узнать  :menuselection:`Слой --> Свойства --> Вкладка :guilabel:`Метаданные` --> строка "Система координат слоя"`.

Открытие окна преобразования координат
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

В правом-нижнем углу карты нажмите вторую справа кнопку. Если на ней написано OTF - значит преобразование на лету включёно.

Если картинка на карте сплющена по вертикали.
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Если вы добавили геоданные на карту, и картинка сплющенная - то включите "Преобразование коодинат на лету" в EPSG:3857. Это значит что ваши геоданные были в градусах.


Если данные из разных слоёв не попадают друг на друга, хотя они в одном месте.
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Включите "Преобразование коодинат на лету".

Пересохранение слоёв в другую систему координат
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Для некоторых операций в инструкции потребуется пересохранить слои в другую систему координат. В этом случае выберите :menuselection:`Слой --> Сохранить как`, и выберите систему координат в диалоге сохранения. 




Добавление геоданных
====================

NextGIS QGIS предоставляет пользователю возможность добавлять

* Векторные данные
* Растровые данные
* Подкладывать тайловые подложки из интернета
* Добавлять растры по протоколу WMS и TMS
* Работать по протоколу WFS
* Добавлять слои из веб-гис NextGIS WEB
* Рисовать самому

Добавление растровых и векторных слоёв из файлов
--------------------------------------------------------

Если слой растровый, то скорее всего он будет в формате GeoTIFF (с расширением .tif)
:menuselection:`Слой --> Добавить слой --> Добавить векторный слой` или :menuselection:`Слой --> Добавить слой --> Добавить растровый слой` соответственно.

При открытии ESRI Shapefile в этом диалоге нужно выбирать файл с расширением .shp.

Так же вам необходимо знать кодировку файлов. Если кодировка файлов - UTF-8, то при работе в ОС Windows в поле "Кодировка" рекомендуется выбирать UTF-8, потому что по умолчанию там будет выбрана системная кодировка, и тогда слой откроется в Win-1251.
Если в таблице атрибутов вы увидите крокозябры - переключите кодировку между UTF-8 и Win-1251 в свойствах слоя.



Добавление картоподложки из интернета
--------------------------------------------------------

Осуществляется плагином QuickMapServices

.. fixme::
   Поставить ссылку на.


Работа с базами данных PostGIS
--------------------------------------------------------



Работа по протоколу WMS
--------------------------------------------------------

Работа по протоколу WFS
--------------------------------------------------------



Добавление картоподложки из интернета
--------------------------------------------------------

Осуществляется плагином QuickMapServices

.. fixme::
   Поставить ссылку на.

Подключение к слоям NGW
--------------------------------------------------------

Осуществляется плагином NGWConnect

.. fixme::
   Поставить ссылку на.

Рисовать самому
========================================================


Настройка стилей
====================

Компоновщик карты
====================

.. `composer_main_properties`:

.. test:
