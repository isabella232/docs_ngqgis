.. sectionauthor:: Дмитрий Барышников <dmitry.baryshnikov@nextgis.ru>

.. _ngqgis_plugins:
    
Модули расширения
=================

QGIS была разработана на архитектуре с поддержкой различных модулей, которые позволяют 
добавлять множество новых возможностей или функций в приложение. QGIS предоставляет 
библиотеки, которые могут использоваться для создания модулей. 
Большинство функций в QGIS реализованы как основные или внешние модули. 
Основные модули написаны на языках программирования C++ и Python.
Все внешние модули в настоящее время написаны на языке Python. Они находятся во 
внешних репозиториях и поддерживаются написавшими их авторами. Внешние модули могут 
быть добавлены с помощью функции Установка модулей QGIS. 

Установка плагинов
-------------------------

Вам потребуется подключение к сети. 

Для установки и обновления плагинов необходимо нажать :menuselection:`Модули --> Управление модулями`.

Если вам надо установить плагин, введите часть его названия в панель Поиск. 


.. figure:: _static/modules_control.png
   :align: center
   :width: 10cm
   
   Список установленных и доступных к загрузке модулей.

Выберите в списке нужный модуль и нажмите кнопку Установить модуль. 

Модули могут быть установленными, но не включёнными: если в списке у модуля не установлен 
флажок, то он не будет загружаться. Активируются модули автоматически с помощью 
установки флажка на соответствующем модуле.

Если вы ввели название модуля правильно, а модуля, который нужно установить не нашли, 
то выполните следующие операции:

1. Проверьте, может быть имя модуля задано на другом языке.
2. Проверьте вкладку Параметры: у репозиториев должна быть зелёная отметка. Если 
   отметка красная, значит проблемы либо в подключении к интернету, либо с сервером.
3. Попробуйте установить флажок для активации пункта Разрешить установку экспериментальных модулей.
4. Проверьте, нужный модуль может находиться в каком-то специальном репозитории, 
   спросите у того, кто вам про него сказал. 


.. _ngq_ngw_connect:

NextGIS Connect
-------------------------
С помощью данного модуля расширения пользователь QGIS получает возможность обмениваться ресурсами с Веб ГИС или NextGIS Web (далее будет использоваться только термин "Веб ГИС") непосредственно из интерфейса QGIS:

1. переносить слои из QGIS в Веб ГИС;
2. переносить QGIS проекты в Веб ГИС целиком;
3. переносить слои из Веб ГИС в QGIS.

После установки модуля на панели инструментов появится иконка: 

.. figure:: _static/nextgis_connect/logo.png
   :align: center
   :alt: Иконка модуля расширения NextGIS Connect.

При нажатии на иконку появится панель управления ресурсами Веб ГИС.

.. figure:: _static/nextgis_connect/panel.png
   :align: center
   :alt: Панель модуля расширения NextGIS Connect

Если на данный момент не настроено ни одно подключение вы увидите сообщение с предложением создать свою Веб ГИС.

.. figure:: _static/nextgis_connect/panel-no-connections.png
   :align: center
   :alt: Панель модуля расширения NextGIS Connect при отсутствии подключения

**Создание подключения**

Для создания подключения вам необходимо знать адрес интересующей вас Веб ГИС.
Например, если вы создали свою Веб ГИС, ее адрес вы можете узнать на странице:
https://my.nextgis.com/webgis

.. figure:: _static/nextgis_connect/my_nextgis.png
   :align: center
   :alt: Адресс Веб ГИС

Нажмите кнопку "Настройки" на панели модуля расширения NextGIS Connect.

.. figure:: _static/nextgis_connect/call_settings.png
   :align: center
   :alt: Вызов диалога настроек

В открывшемся окне нажмите кнопку "Новое" и заполните поля:

1. URL - адрес интересующей вас Веб ГИС
2. Имя - идентификатор подключения для быстрого поиска в списке подключений

Снимите галку "Как гость" и заполните поля "Имя пользователя" и "Пароль",
если вам необходимо выполнять действия, на которые требуется специальное разрешение,
которым не обладает неавторизованный пользователь (Гость).

Например, для того чтобы получить возможность создавать/удалять ресурсы, 
обычно эти действия недоступны неавторизованным пользователям. 

.. figure:: _static/nextgis_connect/connection_settings.png
   :align: center
   :alt: Настойки соединения

Нажмите кнопку "ОК". В выпадающем списке диалога "Настройки" выбираете подключение, которое станет активным 
после закрытия диалога.

**Доступные операции**

*Добавить в QGIS*

.. figure:: _static/nextgis_connect/add_to_qgis.png
   :align: center
   :alt: Добавтить в QGIS

Операция доступна, если в дереве ресурсов NextGIS выбран один из следующих видов ресурсов:

- Векторный слой (NGW Vector Layer) - в QGIS будет создан векторный слой GeoJSON.
- WFS Сервис (NGW WFS Service) - в QGIS будет создан WFS слой источником данных для которого будет
выбранный WFS Сервис.

*Добавить в Веб ГИС*

.. figure:: _static/nextgis_connect/add_to_ngw.png
   :align: center
   :alt: Добавтить в Веб ГИС

Операция "Импортировать выбранный слой" доступна, если в панели слоев QGIS выбран один из следующих видов ресурсов:

- Векторный слой - в Веб ГИС будет создан векторный слой и стиль, аналогичный стилю выбранного слоя в QGIS, который можно добавить на веб карту в Веб ГИС.
- Растровый слой - в Веб ГИС будет создан расторвый слой со стилем по-умолчанию, который можно добавить на веб карту в Веб ГИС.

Операция "Импортировать текущий проект" доступна всегда. В Веб ГИС будут добавлены все слой, для которых доступна
операция "Импортировать выбранный слой", и все группы в соответствии с иерархией в панели слоёв QGIS.
Также будет создана веб карта на которую будут добавлены все импортируемые слой с учетом иерархии и видимости в панели слоёв QGIS.
При выполнение ипорта проекта вам необходимо ввести название новой группы, которая будет создана в Веб ГИС 
для размещения всех ресурсов, имортируемых в рамках данной операции.

Добавление ресурсов в Веб ГИС производится в выбранную на панелни ресурсов Веб ГИС группу.

- Если выбрана не группа, а другой тип ресурса - в ближаюшую родительскую группу выбранного ресурса.
- Если не выбран ресурс - в корневую группу.

.. _ngq_qms:

QuickMapServices
-------------------------

Этот инструмент может применяться для быстрого добавления базовой карты (т.н. подложки) 
в проект QGIS. Растровая картографическая подложка часто выступает в качестве первого 
слоя, добавляемого для работы в проект. Вы можете подложить слой Openstreetmap, 
публичной кадастровой карты РФ и многие другие. 

Подложка может быть представлена в виде различных интернет-сервисов: TMS, WMS, WMTS, 
ESRI ArcGIS Service или просто в виде тайлов XYZ.

После установки расширения в панели инструментов "Интернет" появится кнопка расширения 
(кнопку можно расположить и на другой, возможно более удобной панели, см. Настройки). 
Так же появится группа QuickMapServices в одноименном меню.

.. figure:: _static/modules_Qms-button.png
   :align: center
   :width: 10cm

   Значок кнопки расширения.
   
Кнопка является контейнером для базовых карт из различных источников.

.. figure:: _static/modules_Qms-contrib-4.png
   :align: center
   :width: 10cm

   Список расширений, скрытый за значком кнопки расширения.
   
При выборе одной из них, карта автоматически подключается в проект в качестве слоя. 

Настройки сервисов хранятся отдельно от самого модуля и при удалении/обновлении 
модуля они не удаляются.

.. figure:: _static/modules_Qms-main.jpg
   :align: center
   :width: 10cm
   
   Базовая картографическая основа и слой кадастрового деления с Публичной кадастровой карты.

Настройки
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Общие настройки
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

Окно общих настроек можно вызвать из меню расширения. Что можно настроить:

1. Показывать управление подложками из панели "Управление слоями", по умолчанию 
   управление подложками добавляется в панель "Веб" и ее часто «теряют».
2. Включать перепроецирование при добавлении тайлового слоя (если опция включена, 
   то в проекте автоматически включается перепроецирование в систему координат 
   EPSG: 3857 Pseudo Mercator).
3. Показывать информацию в панели сообщений. По умолчанию они показываются во 
   всплывающей панели, что не всегда удобно.

.. figure:: _static/modules_Qms-contrib-01.png
   :align: center
   :width: 10cm
   
   Общие настройки.

И параметры загрузки тайлов:

1. Максимальное количество соединений для скачивания тайлов.
2. Срок хранения кэша тайлов.
3. Таймаут загрузки тайлов.

.. figure:: _static/modules_Qms-contrib-02.png
   :align: center
   :width: 10cm
   
   Настройки получения тайлов.

Настройки подложки
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

Так как подложка добавленная через QuickMapServices является особым видом слоя, 
её окно настроек отличается от стандартного окна настроек слоя.

Через настройки подложки можно осуществить:

1. Включить-выключить сглаживание.
2. Перевести подложку в оттенки серого.
3. Настроить яркость, контраст, прозрачность.
4. Включить пока копирайтов.

.. figure:: _static/modules_Qms-basemap.png
   :align: center
   :width: 10cm
   
   Настройки подложки.

Дополнительные сервисы
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

После установки модуля зайдите в настройках во вкладку 
:guilabel:`Дополнительные сервисы` и нажмите 
:guilabel:`Получить дополнительные источники данных`.

.. figure:: _static/modules_Qms-moreservises-1.png
   :align: center
   :width: 10cm
   
   Загрузка дополнительных сервисов.

Расширенный набор сервисов может выглядеть так:

.. figure:: _static/modules_Qms-moreservises-2.png
   :align: center
   :width: 10cm
   
   Полный список сервисов.

.. note::
   Если вы планируете делать производную работу на основе подложки из интернета, 
   ознакомьтесь с условиями использования данной подложки, чтобы не нарушить законы 
   об авторских правах. Если вы используете подложку OSM Mapnik, то конечную работу 
   достаточно подписать «© Участники OpenStreetMap». Для подложки Карта Спутник - 
   «© Спутник © Openstreetmap». Другие подложки и космоснимки могут иметь более строгие 
   ограничения на использование. 


.. note::
   Вы можете добавлять в модуль и свои подложки!
   Смотрите описание по адресу http://gis-lab.info/qa/quickmapservices.html
    
