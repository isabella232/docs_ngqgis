.. sectionauthor:: Дмитрий Барышников <dmitry.baryshnikov@nextgis.ru>

.. _ng_connect:
    
NextGIS Connect
===============

С помощью данного модуля расширения пользователь QGIS получает возможность обмениваться 
ресурсами с Веб ГИС или NextGIS Web (далее будет использоваться только термин "Веб ГИС") непосредственно из интерфейса QGIS.

С помощью модуля расширения NextGIS Connect возможно:

1. Загружать геоданные из Веб ГИС в настольную ГИС.
2. Загружать векторные и растровые слои из настольной ГИС в Веб ГИС.
3. Загружать целиком проекты QGIS в Веб ГИС с сохранением стилей оформления, иерархией слоев, и т.п..
4. Создавать WFS-сервисы в один клик и редактировать данные прямо в Веб ГИС.

В NextGIS QGIS модуль входит в состав дистрибутива, и можно начать работать с ним 
сразу после установки. Модуль также доступен и через официальный репозиторий плагинов 
QGIS, так что возможно начать работу с ним и если у вас другая сборка QGIS.

После установки модуля на панели инструментов появится иконка: 

.. figure:: _static/nextgis_connect/logo.png
   :align: center
   :alt: Иконка модуля расширения NextGIS Connect.

При нажатии на иконку появится панель управления ресурсами Веб ГИС.

.. figure:: _static/nextgis_connect/panel.png
   :align: center
   :alt: Панель модуля расширения NextGIS Connect

Если на данный момент не настроено ни одно подключение, вы увидите сообщение с предложением 
создать свою Веб ГИС.

.. figure:: _static/nextgis_connect/panel-no-connections.png
   :align: center
   :alt: Панель модуля расширения NextGIS Connect при отсутствии подключения

Создание подключения
-------------------------

Для создания подключения вам необходимо знать адрес, интересующей вас Веб ГИС.
Например, если вы создали свою Веб ГИС, ее адрес вы можете узнать на странице:
https://my.nextgis.com/webgis

.. figure:: _static/nextgis_connect/my_nextgis.png
   :align: center
   :alt: Адрес Веб ГИС

Нажмите кнопку "Настройки" на панели модуля расширения NextGIS Connect.

.. figure:: _static/nextgis_connect/call_settings.png
   :align: center
   :alt: Вызов диалога настроек

В открывшемся окне нажмите кнопку "Новое" и заполните поля:

1. URL - адрес интересующей вас Веб ГИС.
2. Имя - идентификатор подключения для быстрого поиска в списке подключений.

Снимите галку "Как гость" и заполните поля "Имя пользователя" и "Пароль",
если вам необходимо выполнять действия, на которые требуется специальное разрешение,
которым не обладает неавторизованный пользователь (Гость).

Например, для того чтобы получить возможность создавать/удалять ресурсы, 
обычно эти действия недоступны неавторизованным пользователям. 

.. figure:: _static/nextgis_connect/connection_settings.png
   :align: center
   :alt: Настройки соединения

Нажмите кнопку "ОК". В выпадающем списке диалога "Настройки" выбираете подключение, 
которое станет активным после закрытия диалога.

Основные настройки
-------------------------

.. figure:: _static/nextgis_connect/settings.png
   :align: center
   :alt: Основные настройки

1. Переименовывать запрещенные поля - если опция выбрана, то при импорте слоя отдельно 
или в составе проекта модуль будет переименовывать запрещенные для добавления в Веб ГИС поля;

2. Исправлять некоректные геометрии - если опция выбрана, то при импорте слоя отдельно 
или в составе проекта модуль будет преобразовывать геометрии к одному типу;

3. Прерывать импорт проекта после первой ошибки импорта слоя - если опция выбрана, то 
модуль не будет продолжать процесс импорта, если не удалось импортировать один слой;

4. Открывать карту автоматически после создания - если опция выбрана, то после завершения 
операции, в которых была создана веб карта, она будет открыта в браузере автоматически.


Типы ресурсов
-------------------------
.. |resource_vector_point| image:: _static/nextgis_connect/vector_layer_point.png
.. |resource_vector_mpoint| image:: _static/nextgis_connect/vector_layer_mpoint.png
.. |resource_vector_line| image:: _static/nextgis_connect/vector_layer_line.png
.. |resource_vector_mline| image:: _static/nextgis_connect/vector_layer_mline.png
.. |resource_vector_polygon| image:: _static/nextgis_connect/vector_layer_polygon.png
.. |resource_vector_mpolygon| image:: _static/nextgis_connect/vector_layer_mpolygon.png
.. |resource_wfs| image:: _static/nextgis_connect/resource_wfs.png
.. |resource_wms| image:: _static/nextgis_connect/resource_wms.png
.. |resource_style| image:: _static/nextgis_connect/resource_style.png
.. |resource_webmap| image:: _static/nextgis_connect/resource_webmap.png
.. |resource_group| image:: _static/nextgis_connect/resource_group.png
.. |resource| image:: _static/nextgis_connect/resource.png
- |resource_vector_point| - Точечный векторный слой (NGW Vector Layer)
- |resource_vector_mpoint| - Мультиточечный векторный слой (NGW Vector Layer)
- |resource_vector_line| - Линейный векторный слой (NGW Vector Layer)
- |resource_vector_line| - Мультилинейный векторный слой (NGW Vector Layer)
- |resource_vector_polygon| - Полигональный векторный слой (NGW Vector Layer)
- |resource_vector_mpolygon| - Мультиполигональный векторный слой (NGW Vector Layer)
- |resource_style| - Стиль векторного слоя. QGIS стиль помечается префиксом "(qgis)", стиль MapServer - "(ms)"
- |resource_wfs| - WFS Сервис (NGW WFS Service)
- |resource_wms| - WMS Сервис (NGW WMS Service)
- |resource_webmap| - Веб карта (NGW Web Map)
- |resource_group| - Группа ресурсов (NGW Web Map)

Доступные операции
-----------------------

*Добавить в QGIS*

.. figure:: _static/nextgis_connect/add_to_qgis.png
   :align: center
   :alt: Добавить в QGIS

Операция доступна, если в дереве ресурсов NextGIS выбран один из следующих видов ресурсов:

- Векторный слой (NGW Vector Layer) |resource_vector| - в QGIS будет создан векторный 
  слой GeoJSON.
- WFS Сервис (NGW WFS Service) |resource_wfs| - в QGIS будет создан WFS слой, источником 
  данных для которого будет выбранный WFS Сервис.
- QGIS Стиль Векторного слоя |resource_style| - в QGIS будет создан векторный слой GeoJSON, со стилем идентичным выбранному стилю.

.. |resource_vector| image:: _static/nextgis_connect/resource_vector.png

.. |resource_wfs| image:: _static/nextgis_connect/resource_wfs.png

*Добавить в Веб ГИС*

.. figure:: _static/nextgis_connect/add_to_ngw.png
   :align: center
   :alt: Добавтить в Веб ГИС

Операция "Импортировать выбранный слой" доступна, если в панели слоев QGIS выбран 
один из следующих видов ресурсов:

- Векторный слой - в Веб ГИС будет создан векторный слой и стиль, аналогичный стилю 
  выбранного слоя в QGIS, который можно добавить на веб-карту в Веб ГИС.
- Растровый слой - в Веб ГИС будет создан растровый слой со стилем по умолчанию, 
  который можно добавить на веб-карту в Веб ГИС.

Операция "Импортировать текущий проект" доступна всегда. В Веб ГИС будут добавлены 
все слои, для которых доступна операция "Импортировать выбранный слой", и все группы 
в соответствии с иерархией в панели слоёв QGIS.
Также будет создана веб-карта, на которую будут добавлены все импортируемые слои 
с учетом иерархии и видимости в панели слоёв QGIS.
При выполнение импорта проекта вам необходимо ввести название новой группы, которая 
будет создана в Веб ГИС для размещения всех ресурсов, импортируемых в рамках данной операции.
После импорта проекта созданная веб-карта откроется в браузере автоматически, если в настройках модуля
выбрана соответствуйщая опция.

Добавление ресурсов в Веб ГИС производится в выбранную на панели ресурсов Веб ГИС группу.

- Если выбрана не группа, а другой тип ресурса - в ближайшую родительскую группу выбранного ресурса.
- Если не выбран ресурс - в корневую группу.

*Создать группу ресурсов в Веб ГИС*

.. figure:: _static/nextgis_connect/create_group.png
   :align: center
   :alt: Создать новую группу ресурсов

Операция доступна всегда. В Веб ГИС будет создана новая группа ресурсов.
Новая группа будет создана в группе ресурсов:

- которая выбрана в дереве ресурсов Веб ГИС;
- которая является ближайшей родительской группой для выбранного ресурса, если он 
  не является группой ресурсов;
- в основной группе ресурсов, если не выбран ни один ресурс в дереве ресурсов Веб ГИС.

*Обновить дерево ресурсов*

.. figure:: _static/nextgis_connect/reload.png
   :align: center
   :alt: Обновить дерево ресурсов

Операция обновит все дерево ресурсов.

*Открыть веб-карту в браузере*

.. figure:: _static/nextgis_connect/open_webmap.png
   :align: center
   :alt: Открыть веб-карту в браузере

Операция доступна, если в дереве ресурсов выбран ресурс веб-карта (NGW Web Map) |resource_webmap|. 
Открывает карту в новой вкладке браузера, который установлен по умолчанию.

.. |resource_webmap| image:: _static/nextgis_connect/resource_webmap.png

Контекстное меню
-----------------------
Контекстное меню может отличаться у различных ресурсов. 

.. figure:: _static/nextgis_connect/context_menu.png
   :align: center
   :alt: Контекстное меню qgis стиля векторного слоя

Общедоступные операции:

- Открыть в ВебГИС - открывать страницу выбранного ресурса в Веб ГИС;

- Переименовать - переименовать ресурс;

- Удалить - удалить ресурс.


Опциональные - зависит от типа ресурса:

- Добавить в qgis - операция описана выше;

- Создать веб карту - доступен только для ресурсов: Векторный слой и Стиль Векторного слоя;

- Скачать стиль - доступен только для ресурса QGIS Стиль Векторного слоя.

